# AI资产管理系统项目结构文档

## 📁 项目整体结构

该AI资产管理系统是一个基于MCP（Model Context Protocol）协议的服务器，专门用于管理各类AI相关资产，包括提示词（prompts）、人物角色（personas）和工具定义（tool definitions）。

```
mantras/                    # 项目根目录
├── src/                    # 源代码目录
│   ├── server.ts          # 主服务器程序 - MCP服务器核心
│   ├── asset-repository.ts # 资产数据仓库 - 管理所有AI资产的核心模块
│   ├── asset-sources.ts   # 资产来源配置 - 远程URL和默认资产定义
│   ├── types.ts          # TypeScript类型定义
│   ├── log-to-file.ts    # 日志文件管理工具
│   ├── server.test.ts    # 服务器测试文件
│   └── asset-repository.test.ts # 仓库模块测试文件
├── dist/                 # 构建产物目录（已编译的JavaScript文件）
├── docs/                 # 项目文档目录
│   ├── README.md         # 英文项目说明文档
│   └── ARCHITECTURE.md   # 英文架构设计文档
├── node_modules/         # npm依赖包
├── package.json          # 项目配置文件（依赖、脚本等）
├── tsconfig.json         # TypeScript编译配置
├── jest.config.cjs      # Jest测试框架配置
└── debug.log           # 调试日志文件
```

## 🔧 核心模块详细分析

### 1. **server.ts** - MCP服务器引擎
**功能定位**：整个系统的引擎，负责与外界交互
- 🚀 初始化和启动MCP服务器
- 🛠️ 注册可用工具（如`list_assets`列出资产、`get_asset`获取特定资产）
- 📞 处理来自MCP客户端的工具调用请求
- 🔄 将请求分发到适当的处理函数

### 2. **asset-repository.ts** - 资产数据管理中枢
**功能定位**：系统的数据管理中心
- 📡 从远程URL获取资产数据（支持网络数据源）
- 💾 从本地JSON文件加载用户自定义资产
- 🏃 实现智能缓存层，避免重复网络请求
- 🔄 在远程源不可用时优雅回退到默认资产
- 🧩 智能合并远程、本地和默认资产（本地资产优先级最高）

### 3. **asset-sources.ts** - 资产来源配置中心
**功能定位**：定义资产的获取来源
- 🌐 配置远程资产源URL列表（支持多个数据源）
- 📋 提供内置默认资产集合（`Asset[]`）作为系统后备
- ⚙️ 灵活的数据源管理策略

### 4. **types.ts** - 类型系统定义
**功能定位**：整个项目的类型安全基石
- 📊 定义`Asset`接口 - 资产的统一数据结构
- 🎯 定义`AssetType`类型 - 资产类型枚举（persona、prompt、tool）
- 🏗️ 定义`AssetRepository`接口 - 仓库操作规范

### 5. **log-to-file.ts** - 日志管理模块
**功能定位**：系统监控和问题调试工具
- 📝 文件日志记录功能
- 🔍 调试信息输出
- 📊 系统运行状态跟踪

## 🎯 项目核心特色

### 🔍 多类型资产支持
- **Persona（人物角色）**：AI助手的人格定义
- **Prompt（提示词）**：优化AI交互的指令模板
- **Tool（工具定义）**：AI可调用的外部功能描述

### 🌐 多源联邦架构
- **远程URL**：实时获取最新资产
- **本地文件**：用户自定义配置
- **内置默认**：系统提供的基础资产库

### ⚡ 智能管理特性
- **缓存机制**：自动缓存远程资产，减少网络延迟
- **优先级系统**：本地资产 > 远程资产 > 默认资产
- **故障回退**：在网络异常时保证系统可用性

### 🤝 生态集成能力
- **MCP协议标准**：与所有MCP兼容客户端无缝集成
- **命令行工具**：支持脚本化操作
- **灵活配置**：支持运行时参数调整

## 🚀 快速开始指南

### 构建项目
```bash
npm install    # 安装依赖
npm run build  # 构建项目
```

### 运行服务
```bash
# 基本运行
node dist/server.js

# 指定本地资产文件
node dist/server.js --personas /path/to/your/assets.json
```

### 集成使用
该服务设计为与MCP客户端配合使用，如：
- Claude Desktop
- 其他支持MCP协议的IDE
- 自定义MCP客户端应用

## 🏗️ 架构设计亮点

1. **分层架构**：清晰的层次分离（服务器→仓库→数据源）
2. **扩展性**：模块化设计便于功能扩展
3. **可靠性**：多层次的故障恢复机制
4. **性能**：智能缓存减少网络依赖
5. **安全性**：类型安全的TypeScript实现

---
*本文档基于项目v1.0.0版本生成*